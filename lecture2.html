<!DOCTYPE html>
<!--
    Middleware and Web Services, CTU course slides
    (cc) 2010-2013 Tomas Vitvar, http://vitvar.com
    written for Humla, an open source HTML5 presentation environment
-->
<html>  
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
        <meta name="course"   content="Middleware and Web Services"/>
        <meta name="lecture"  content="Lecture 2"/>
        <meta name="keywords" content="REST, resource identification, resource representation"/>
           
        <link type="text/css" rel="stylesheet" href="css/meta.css"></link>   
        <link type="text/css" rel="stylesheet" href="css/ctu-fit.css"></link>   
        <link type="text/css" rel="stylesheet" href="humla/lib/core/humla.css"></link>   

        <script type="text/javascript" src="humla/lib/humla.js"></script>
        <title>Representational State Transfer</title>
    </head>
    
    <body>
        <footer>
            <p><b>#META_LECTURE#: #TITLE#</b>,&nbsp;<span class="meta_semester"/>,&nbsp;
            <span class="meta_twitter"/></p>
            <p><b>&#8210; #SLIDE_NO# &#8210;</b></p>
        </footer>

        <div class="slide intro">
            <hgroup>
                <h1><span class="meta_course"/></h1>
                <h2>#META_LECTURE#: #TITLE#</h2>
            </hgroup>
            <div class="author">
                <p class="meta_author"/>
                <p><span class="meta_email"/> &bull; <span class="meta_twitter"/> &bull; 
                <span class="meta_web"/></p>
            </div>
            <center><div class="meta_logo"></div></center>
            <div class="org">
                <p class="meta_org"/>
                <p><span class="meta_orgfac"/> &bull; <span class="meta_field"/> 
                &bull; <span class="meta_orgweb"/></p>
            </div>
            <div class="etc">
                <div class="text-info">
                    Modified: #LAST_MODIFIED#<br/>
                    Humla v#HUMLA_VERSION#
                </div>
                <a href="http://creativecommons.org/licenses/by-sa/3.0/"><div class="license"></div></a>
                <div class="oppa"></div>
            </div>
        </div>
        
        <div class="slide outline"></div>
        
        <section>
            <header>Introduction to REST</header>
            
    		<div class="slide">
    			<hgroup>
    				<h1>REST</h1>
    			</hgroup>
    			<ul class="small spacing">
                    <li>REST</li>
                    <ul>
                        <li>Representational State Transfer</li>
                    </ul>
    				<li>Architecture Style</li>
    				<ul>
    					<li>Roy Fielding &ndash; co-author of HTTP</li>
    					<li>He coined REST in his <span class="h-ref" id="rest">PhD thesis</span>.</li>
                        <ul>
                            <li>The thesis abstracts from HTTP technical details</li>
                            <li>HTTP is one of the REST implementation &rarr; <b>RESTful</b></li>
                            <li>REST is a leading programming model for Web APIs</li>
                        </ul>
    				</ul>
    				<li>REST (RESTful) proper design</li>
    				<ul>
    					<li>people break principles often</li>
    					<li>See <span class="h-ref" id="rest-anti">REST Anti-Patterns</span> for some details.<br/>
    				</ul>
    				<li>REST and Web Service Architecture</li>
    				<ul>
    					<li>REST is a realization of WSA resource-oriented model</li>
    				</ul>
    			</ul>			
    		</div>
            
            <div class="slide">
                <hgroup>
                    <h1>REST and Web Architecture</h1>
                </hgroup>
        		<ul class="small">
					<li>Tim-Berners Lee</li>
					<ul>
						<li>"creator", father of the Web</li>
					</ul>
					<li>Key Principles</li>
					<ul>
						<li>Separation of Concerns</li>
                        <ul>
						    <li>enables independent innovation</li>
                        </ul>
						<li>Standards-based</li>
                        <ul>
						    <li>common agreement, big spread and adoption</li>
                        </ul>
						<li>Royalty-free technology</li>
                        <ul>
						    <li>a lot of open source, no fees</li>
                        </ul> 
					</ul>
					<li>Architectural Basis</li>
					<ul>
						<li><b>Identification:</b> universal linking of resources using URI</li>
						<li><b>Interaction:</b> protocols to retrieve resources &ndash; HTTP</li>
						<li><b>Formats:</b> resource representation (data and metadata)</li>				
					</ul>
				</ul>                
            </div>      

            <div class="slide">
    			<hgroup>
    				<h1>HTTP Advantages</h1>
    			</hgroup>
    			<ul class="small spacing">
					<li>Familiarity</li>
					<ul>
						<li>HTTP protocol is well-known and widely used</li>
					</ul>
					<li>Interoperability</li>
					<ul>
						<li>All environments have HTTP client libraries</li>
                        <ul>
						    <li>technical interoperability is thus no problem</li>
                            <li>no need to deal with vendor-specific interoperability issues</li>
                        </ul>
						<li>You can focus on the core of the integration problem</li>
                        <ul>
						    <li>application (domain, content) interoperability</li>
                        </ul>
					</ul>
					<li>Scalability</li>
					<ul>
						<li>you can use highly scalable Web infrastructure</li>
						<ul>
                            <li>caching servers, proxy servers, etc.</li>
                        </ul>
						<li>HTTP features such as HTTP GET idempotence and safe 
                            allow you to use caching</li>
					</ul>
				</ul>
    		</div>
            
            <div class="slide">
    			<hgroup>
    				<h1>Some Statistics</h1>
    			</hgroup>
                <ul class="small">
                    <li>ProgrammableWeb data</li>
                    <ul>
                        <li>Distribution of API protocols and styles</li>
                        <img src="img/l4/rest-vs-soap.png"></img>
                        <li>Based on directory of 2,000 Web APIs listed at ProgrammableWeb, May 2010.</li>
                        <li>Source <span class="h-ref" id="open-apis">Open APIs: a State of the Market</span></li>
                    </ul>
                </ul>
    		</div>

            <div class="slide">
        		<hgroup>
    				<h1>REST Core Principles</h1>
    			</hgroup>
                <ul class="small">
                    <li>REST architectural style defines constraints</li>
                    <ul>
                        <li>if you follow them, they help you to achieve a good design, 
                        interoperability and scalability.</li>
                    </ul>
                    <li>Constraints</li>
                    <ul>
                        <li>Client/Server</li>
                        <li>Statelessness</li>
                        <li>Cacheability</li>
                        <li>Layered system</li>
                        <li>Uniform interface</li>
                    </ul>
                    <li>Guiding principles</li>                        
                    <ul>    
                        <li>Identification of resources</li>
                        <li>Representations of resources and self-descriptive messages</li>
                        <li>Hypermedia as the engine of application state (HATEOAS)</li> 
                    </ul>
                </ul>
    		</div>

            <div class="slide">
    			<hgroup>
					<h1>Resource</h1>
				</hgroup>
                <ul class="x-small">
                    <li>A resource can be anything such as</li>
                    <ul>
                        <li>A real object: car, dog, Web page, printed document</li>
                        <li>An abstract thing such as address, name, etc. &rarr; RDF</li>
                    </ul>
                    <li>A resource in REST</li>
                    <ul>
                        <li>A resource corresponds to one or more entities of a data model</li>
                        <li>A representation of a resource can be conveyed in a message electronically (information resource)</li>
                        <li>A resource has an identifier and a representation and a client can apply an access to it</li>
                    </ul>
                </ul>
				<div class="h-drawing" style="height: 200px" 
                    id="1sSCJVFnKU0UgLek_FlFdQfKVeT9myKf-34IYyw5FQps"></div>
			</div>

        	<div class="slide">
    			<hgroup>
    				<h1>Access to a Resource</h1>
    			</hgroup>
    			<div class="h-drawing" style="height: 290px;" 
    				id="1hw7HbAaK09w3I1mtmsJZMb3_OsYpFlBrrJjJRGsz23g"></div>
                <ul class="x-small">
                    <li>Terminology</li>
                    <ul>
                        <li>Client = User Agent</li>
                        <li><b>Dereferencing URI</b> &ndash; a process of obtaining a protocol from the URI and creating a request.</li>
                        <li><b>Access</b> &ndash; a process of sending a request and obtaining a response as a result; 
                        access usually realized through HTTP.</li>
                    </ul>
                </ul>
    		</div>

        </section>

        <div class="slide outline"></div>
    
        <section>
            <header>Uniform Resource Identifier</header>
    
			<div class="slide">
				<hgroup>
                    <h1>URI, URL, URN</h1>
				</hgroup>
				<ul class="small spacing">
					<li>URI &ndash; Uniform Resource Identifier</li>
					<ul>
						<li>URI only identifies a resource</li>
                        <ul>
						    <li>it does not imply the resource physically exists</li>
                        </ul>
						<li>URI could be URL (locator) or URN (name)</li>
					</ul>
					<li>URL &ndash; Uniform Resource Locator</li>
					<ul>	
						<li>in addition allows to locate the resource</li>
                        <ul>
						    <li>that is &mdash; its network location</li>
                        </ul>
						<li>every URL is URI but an URI does not need to be URL</li>
					</ul>
					<li>URN &ndash; Uniform Resource Name</li>
					<ul>
						<li>refers to URI under "urn" scheme (<span class="h-ref" id="rfc-2141">RFC 2141</span>)</li>
						<li>require to be globally unique and persistent</li>
                        <ul>
						    <li>even if the resource cease to exist/becomes unavailable</li>
                        </ul>
					</ul>
				</ul>
			</div>
                            
			<div class="slide">
				<hgroup>
					<h1>URI</h1>
				</hgroup>
				<ul class="x-small">
                    <li>Definition</li>
                    <pre class="brush: plain; gutter: 'false'; class-name: 'tight'">
                        URI = scheme ":" [ "//" authority ] [ "/" path ] [ "?" query ] [ "#" frag ]
				    </pre>
					<li>Hierarchal sequence of components</li>
                    <ul>
						<li><code>scheme</code></li>
						<ul>
							<li>refers to a spec that assigns IDs within that scheme</li>
							<li>examples: <code>http</code>, <code>ftp</code>, <code>mailto</code>, <code>urn</code></li>
                            <li><code>scheme != protocol</code></li>
						</ul>
						<li><code>authority</code></li>
						<ul>
							<li>registered name (domain name) or server address</li>
							<li>optional port and user</li>
						</ul>
						<li><code>path and query</code></li>
						<ul>
							<li>identify resource within the scheme and authority scope</li>
							<li>path &ndash; hierarchal form</li>
							<li>query &ndash; non-hierarchal form (parameters key=value)</li>
						</ul>
						<li><code>fragment</code></li>
						<ul>
							<li>reference to a secondary resource within the primary resource</li>
						</ul>
                    </ul>
				</ul>
			</div>
            
            <div class="slide outline"></div>
            
            <section>
                <header>Resources and Application Data</header>
            
                <div class="slide">
    				<hgroup>
    					<h1>Resources over Entities</h1>
    				</hgroup>                
                    <ul class="x-small">
                        <li>Application's data model</li>
                        <ul>
                            <li>Entities and properties that the app uses for its data</li>
                        </ul>
                        <div class="h-drawing" style="height: 290px" id="1zT46lCNzfiaw9d5HfA6fzDZFAj2GQG8sRAg1QRWPPfQ"></div>
                        <li>URI identifies a resource within the app's data model</li>
                        <ul>
                            <li><code>path</code> &ndash; a "view" on the data model</li>
                            <ul>
                                <li>data model is a graph</li>
                                <li>URI identifies a resource using a path in a tree with some root</li>
                            </ul>
                        </ul>
                    </ul>
                </div>
    
                <div class="slide">
        			<hgroup>
    					<h1>Examples of Views</h1>
    				</hgroup>                
                    <ul class="x-small">
                        <li>View 1</li>
                        <ul>
                            <li>all customers: <code>/customers</code></li>
                            <li>a particular customer: <code>/customers/{customer-id}</code>
                            <li>All orders of a customer: <code>/customers/{customer-id}/orders</code>
                            <li>A particular order: <code>/customers/{customer-id}/orders/{order-id}</code>
                        </ul>
                        <li>View 2</li>
                        <ul>
                            <li>all orders: <code>/orders</code></li>
                            <li>All orders of a customer: <code>/orders/{customer-id}</code>
                            <li>A particular order: <code>/orders/{customer-id}/{order-id}</code>
                        </ul>
                        <li class="no-bullet">&rArr; Design issues</li>
                        <li>Good design practices</li>
                        <ul>
                            <li>No need for 1:1 relationship between resources and data entities</li> 
                            <ul>
                                <li>A resource may aggregate data from two or more entities</li>
                                <li>Thus only expose resources if it makes sense for the service</li>
                            </ul>
                            <li>Try to limit URI aliases, make it simple and clear</li>
                        </ul>
                        </ul>
                    </ul>
                </div>
    
                <div class="slide">
            		<hgroup>
    					<h1>Path vs. Query</h1>
    				</hgroup>                
                    <ul class="x-small">
                        <li>Path</li>
                        <ul>
                            <li>Hierarchical component, a view on the data</li>
                            <li>The main identification of the resource</li>
                        </ul>
                        <li>Query</li>
                        <ul>
                            <li>Can define selection, projection or other processing instructions</li>
                            <li>Selection</li>
                            <ul>
                                <li>filters entries of a resource by values of properties<br/>
                                <code>/customers/?status=valid</code></li>
                            </ul>
                            <li>Projection</li>
                            <ul>
                                <li>filters properties of resource entries<br/>
                                <code>/customers/?properties=id,name</code></li>
                            </ul>
                            <li>Processing instructions examples</li>
                            <ul>
                                <li>data format of the resource &rarr; cf. URI opacity<br/>
                                <code>/customers/?format=JSON</code></li>
                                <li>Access keys such as API keys<br/>
                                <code>/customers/?key=3ae56-56ef76-34540aeb</code></li>
                            </ul>
                        </ul>
                    </ul>
                </div>
    
    			<div class="slide">
    				<hgroup>
    					<h1>Fragment</h1>
    				</hgroup>
    				<ul class="small">
    					<li>Primary resource</li>
    					<ul>
                            <li>Defined by URI path and query</li>
    						<li>could be complex, composed resources</li>
    					</ul>
    					<li>Sub-resource/secondary resource</li>
    					<ul>
                            <li>Can be defined by a fragment</li>
    						<li>No explicit relationship between primary and sub-resource</li>
                            <ul>
                                <li>For example, we cannot infer that the two resources are in <code>part-of</code>, 
                                or <code>sub-class-of</code> relationships.</li>
                            </ul>
                            <li>Fragment semantics defined by a data format</li>
    					</ul>
                        <li>Usage of fragment</li>
                        <ul>
                            <li>identification of elements in HTML</li>
                            <li>URI references in RDF</li>
                            <li>State of an application in a browser</li>
                        </ul>
                    </ul>
                </div>
                
        		<div class="slide">
    				<hgroup>
    					<h1>Fragment Semantics</h1>
    				</hgroup>
    				<ul class="small">                
                        <li>Fragment semantics for HTML</li>
                        <ul>
                            <li>assume that <code>orders.html</code> are in <code>HTML</code> format.</li>
                        </ul>
                        <pre class="brush: plain">
                            http://company.com/tomas/orders.html#3456
                        </pre>
                        <ul>
                            <li class="no-bullet">&rArr; there is a HTML element with <code>id=3456</code></li>
                        </ul>
                        <li>But:</li>
                        <ul>
                            <li>Consider <code>orders</code> resource in <code>application/xml</code></li>
                        </ul>
                        <pre class="brush: xml">
                            &lt;orders>
                                &lt;order id="3456">...&lt;/order>
                                ...
                            &lt;/orders>
                        </pre>
                        <ul>
                            <li>Can't say that <code>http://company.com/tomas/orders.xml#3456</code> identifies 
                            an order element within the <code>orders</code> resource.</li>
                            <li><code>application/xml</code> content type does not define fragment semantics</li>
                        </ul>
    				</ul>
    			</div>
                
                <div class="slide">
                    <hgroup>
                        <h1>Resource ID vs. Resource URI</li>
                    </hgroup>
                    <ul class="small">
                        <li>Resource ID</li>
                        <ul>
                            <li>Local ID, part of an entity in a data model</li>
                            <li>Unique within an application where the resource belongs</li>
                            <li>Usually generated on a server (cf. <a href="lecture5.html#/PUT">PUT to update and insert</a>)</li>
                            <li>Exposed to the resource URI as a path element<br/>
                            <code>/orders/{order-id}</code></li>                            
                        </ul>
                        <li>Resource URI</li>
                        <ul>
                            <li>Global identifier, valid on the whole Web</li>
                            <li>Corresponds to the view on the data model of the app</li>
                            <li>Include multiple "higher" resources' IDs</li>
                            <li>Example:<br/>
                            <code>/customers/{customer-id}/orders/{order-id}/</code></li>   
                            <li>There can be more URIs identifying the same resource</li>
                        </ul>
                        
                    </ul>
                </div>
                
            </section>
            
            <div class="slide outline"></div>
            
            <section>
                <header>Good URI/URL Design</header>

                <div class="slide" id="uri-alias-collision">
                    <hgroup>
                        <h1>Capability URL</h1>
                    </hgroup>
                    <ul class="x-small">
                        <li>What's capabiliy URL</li>
                        <ul>
                            <li>They are usually valid for a short period of time</li>
                            <li>They are not public, they are private to one person or a group of people</li>
                            <li>Ephemeral resources</li>
                        </ul>
                        <li>Examples</li>
                        <ul>
                            <li>Password resets, Polls, Google calendar's private URLs, ...</li>
                            <li>Access control &ndash; key, session</li>
                        </ul>
                        <li>Design considerations</li>
                        <ul>
                            <li>They should be https resources!</li>
                            <ul>
                                <li>limits exposure, in logs or on the network</li>
                            </ul>
                            <li>They should be revokable by the user/owner</li>
                            <li>They should not be persistent, they should expire</li>
                        </ul>
                        <li>Normal URLs</li>
                        <ul>
                            <li>No URL collision, URI opacity, human readable, independence on a context, persistent URI</li>
                        </ul>
                    </ul>
                </div>

    			<div class="slide" id="uri-alias-collision">
    				<hgroup>
    					<h1>URI Aliases and URI Collision</h1>
    				</hgroup>
    				<ul class="x-small">
    					<li>URI Alias</li>
                        <ul>
                            <li>More than one URI identifies a single resource</li>
                            <li>This happens, for example</li>
                            <ul>
                                <li>Different views on the same data entity<br/>
                                view 1: <code>/customers/{customer-id}/orders</code><br/>
                                view 2: <code>/orders/{customer-id}</code></li>
                                
                                <li>DNS load balancing:<br/>                                
                                domain name 1: <code>http://api.company.com/orders</code><br/>
                                domain name 2: <code>http://api2.company.com/orders</code></li>
                            </ul>
                        </ul>
                        <li>URI Collision</li>
                        <ul>
                            <li>Two resources have one URI</li>
                            <li>This should not happen, for example</li>
                            <ul>
                                <li>A company uses an authority it does not own<br/>                                
                                company Amazon: <code>http://amazon.com/orders</code><br/>
                                company Knihy.cz: <code>http://amazon.com/orders</code></li>
                                <li>Exception: domain <code>example.org</code></li>
                            </ul>
                        </ul>
                    </ul>
    			</div>
    			
    			<div class="slide">
    				<hgroup>
    					<h1>Representation Reuse</h1>
    				</hgroup>
    				<ul class="small">	
    					<li>Compare this:</li>
     					<ul>
    						<li><code>http://company.com/tomas/orders/?date=111001</code><br/>
    						&rarr; all orders of Tomas till 1st October 2011</li>
    						<li><code>http://company.com/tomas/orders</code></li>
                            <ul>
        						<li>all orders of Tomas till today</li>
    						    <li>when retrieved on 1st October 2011,<br/>will be the same as the first resource</li>
                            </ul>
                            <li class="space-before">These are different resources</li>
                            <ul>
                                <li>We say the two resources reused their representations</li>
                                <li>Representation reuse only happens under certain conditions</li>                                
                            </ul>
    					</ul>
    				</ul>
    			</div>
    
    			<div class="slide" id="uri-opacity">
    				<hgroup>
    					<h1>URI Opacity</h1>
    				</hgroup>
    				<ul class="small">	
                        <li>URI does not describe a resource data format</li>
                        <ul>
                            <li>In general it does not describe any resource metadata</li>
                            <li>Thus we cannot determine a format through URIs</li>
                            <ul>
                                <li>There is no relation between URI and HTTP</li>
        					    <li>HTTP media types does not affect URI path component</li>
                            </ul>                            
                        </ul>
    					<li>Example</li>
    					<ul>
    						<li><code>http://company.com/orders.html</code></li>
                            <ul>
                                <li>there is no guarantee that the resource is in <code>text/html</code> format</li>
                            </ul>
    					</ul>
                        <li>However, it sometimes comes handy</li>
                        <ul>
                            <li>Easy to retrieve a data format by tweaking URL (browser)</li>
                            <li>For example, Google API uses query parameter <code>alt</code></li>
                            <li>No need to fiddle with headers and using tools such as <code>curl</code></li>
                        </ul>
    				</ul>
    			</div>
    			
    			<div class="slide">
    				<hgroup>
    					<h1>Human Readable URI</h1>
    				</hgroup>
    				<ul class="small">	
    					<li>URIs are both for machines and users</li>
    					<ul>
    						<li>Users should be able to memorize them</li>
                            <li>URIs should contain pronounceable words, good number of path components, 
                            clear query parameters, etc.</li>
    					</ul>
    					<li>Example</li>
    					<ul>
    						<li>A human readable:<br/>
    						<code>http://company.com/tomas/orders/</code></li>
    						<li>Not really human readable:<br/>
    						<code>http://company.com/?c=gjddjsj224&a=58584&jbd=5553a</code></li>							
    					</ul>
    					<li>URIs generated by a machine &ndash; capability URLs</li>
    					<ul>
                            <li>URLs that are not meant to be "remembered"</li>
    					</ul>
    				</ul>
    			</div>
    							
    			<div class="slide">
    				<hgroup>
    					<h1>Independence on a Context</h1>
    				</hgroup>
    				<ul class="x-small">
    					<li>URIs are independent on a user context</li>
    					<ul>
    						<li>It should be possible to share URIs among users</li>
                            <ul>
                                <li>For example, you send an URI over an IM system</li>
                                <li>Others should be able to retrieve the same resource as you<br/>
                                (if they have rights)</li>
                            </ul>
    					</ul>
    					<li>BUT:</li>
    					<ul>
    						<li>URL may include an access or a session information &ndash; capability URL</li>
    					</ul>
    					<li>Example</li>
    					<ul>
    						<li>Capability URL: <code>http://company.com/orders/?session=5582&user=bob</code></li>
                            <ul>
                                <li>This cannot be reused by other user than Bob</li>
                            </ul>
    						<li>No context: <code>http://company.com/orders/</code></li>
                            <ul>
                                <li>a user needs to be logged in to access the resource</li>
                                <li>HTTP authorization header identifies the user</li>
                            </ul>
    					</ul>
    				</ul>
    			</div>

    			<div class="slide">
					<hgroup>
						<h1>Resource Versions</h1>
					</hgroup>
					<ul>
						<li>Resources evolve over time</li>
						<li>Need to deal with various versions</li>
						<ul>
							<li>need to support old clients on old versions</li>
							<li>allow new clients to use new versions</li>
						</ul>
						<li>Versioning at URI level</li>
						<ul>
							<li>one path element to identify a version<br/>
							<code>http://company.com/v1/tomas/orders</code>
                            <li>should be part of the path component not a query</li>
							<li>API version</li>
                            <ul>
                                <li>version applies to a set of resources</li>
                            </ul>
						</ul>
						<li>Versioning at resource meta-data level</li>
						<ul>
							<li>cf. <a href="#/resource-versions">Version control via content negotiation</a></li>
						</ul>
					</ul>
				</div> 
    
    			<div class="slide">
    				<hgroup>
    					<h1>Persistent URI</h1>
    				</hgroup>
    				<ul>
    					<li>Good URLs should not change</li>
    					<ul>
    						<li>They should be indefinitely assigned to a resource</li>
    						<li>even if the resource does not exist anymore</li>
    					</ul>
    					<li>HTTP and URI persistence</li>
    					<ul>
    						<li>new URI associated with the resource</li>
    						<li>HTTP redirection through <code>3xx</code> response codes</li>
                            <ul>
                                <li>See response codes</li>
                            </ul>
    					</ul>
                        <li>Capability URLs are not usually persisent</li>
    				</ul>
    			</div>        
            </section>
    
        </section>

        <div class="slide outline"></div>

        <section>
            <header>Resource Representation</header>
            
            <section>
                <header>Representation, Data Format and Metadata</header>
                            
        		<div class="slide">
    				<hgroup>
    					<h1>Representation and Data Format</h1>
    				</hgroup>
                    <ul class="small">
                        <li>Representation</li>
                        <ul>
                            <li>Various languages, one resource can have multiple representations</li>
                            <ul>
                                <li>XML, HTML, JSON, YAML, RDF, ...</li>
        					    <li>should conform to Internet Media Types</li>
                            </ul>
                        </ul>
                        <li>Data format</li>
                        <ul>
                            <li>Format of resource data</li>
            				<li>Binary format</li>
        					<ul>
        						<li>specific data structures</li>
        						<li>pointers, numeric values, compressed, etc.</li>
        					</ul>
        					<li>Textual format</li>
        					<ul>
        						<li>in a defined encoding as a sequence of characters</li>
        						<li>HTML, XML-based formats are textual</li>
        					</ul>
                        </ul>
                    </ul>
    			</div>
                
    			<div class="slide">
    				<hgroup>
    					<h1>Metadata</h1>
    				</hgroup>
    				<ul class="x-small">
                        <li>Metadata ~ self-description</li>
                        <ul>
                            <li>Data about the resource</li>
                            <li>e.g., data format, representation, date the resource was created, ...</li>
                            <li class="space-before no-bullet">1. Defined by HTTP response headers</li>
                            <li class="no-bullet">2. Can be part of the data format</li>
                            <ul>
                                <li>AtomPub protocol such as <code>author</code>, <code>updated</code>, ...</li>
                                <li>HTML <code>http-equiv</code> meta tags</li>
                            </ul>
                        </ul>
                        <li>Resource anatomy</li>
                        <div class="h-drawing" style="height: 220px" id="1AYsQub6fAGV4Z_R2BdIm4JPmoqtamueF9ABNoyPKyJ4"></div>
    				</ul>				
    			</div>
                
        		<div class="slide">
    				<hgroup>
    					<h1>Content-Type Metadata</h1>
    				</hgroup>
    				<ul class="x-small">
    					<li>Access</li>
    					<ul>
    						<li>to be retrieved (GET)</li>
    						<li>to be inserted or updated (PUT, POST)</li>
    						<li>to be deleted (DELETE)</li>
    					</ul>
                        <li>Request</li>
                        <ul>
                            <li>HTTP header <code>Accept</code>, part of content negotiation protocol</li>
                        </ul>
                        <li>Response</li>
                        <ul>
                            <li>HTTP header <code>Content-Type: type/subtype; parameters</code></li>
                            <li>Specifies an <span id="rfc-2045" class="h-ref">Internet 
                                Media Type</span> of the resource representation.</li>
                            <ul>
            					<li>IANA (Internet Assigned Numbers Authority) 
        						  manages a <span id="iana-media-types" class="h-ref">registry of media types</span> and character encodings</li>
        						<li>subtypes of <code>text</code> type have an optional charset parameter<br/>
        						<code>text/html; charset=iso-8859-1</code></li>                        
                            </ul>
                            <li>A resource may provide more than one representations</li>
                            <ul>
                                <li>promotes services' loose coupling</li>
                            </ul>
                        </ul>
    				</ul>
    			</div> 
    
    			<div class="slide">
    				<hgroup>
    					<h1>Major Media Types</h1>
    				</hgroup>
    				<ul class="small">
    					<li>Common Standard Media Types</li>
    					<ul>
    						<li><code>text/plain</code></li>
                            <ul>
    							<li>natural text in no formal structures</li>
                            </ul>
    						<li><code>text/html</code></li>
                            <ul>
    							<li>natural text embedded in HTML format</li>
                            </ul>
    						<li><code>application/xml</code>, <code>application/json</code></li>
                            <ul>
        						<li>XML-based/JSON-based, application specific format</li>
                            </ul>
    						<li><code>application/wsdl+xml</code></li>
                            <ul>
        						<li><code>+xml</code> suffix to indicate a specific format</li>
                            </ul>
    					</ul>
    					<li>Non-standard media types</li>
    					<ul>
    						<li>Types or subtypes that begin with <code>x-</code> are not in IANA<br/>
                            <code>application/x-latex</code></li>
        					<li>subtypes that begin with <code>vnd.</code> are vendor-specific<br/>
        					<code>application/vnd.ms-excel</code></li>
    					</ul>
    				</ul>
    			</div>             
            </section>
            
            <div class="slide outline"></div>
            
            <section>
                <header>Resource State</header>
           
            	<div class="slide">
    				<hgroup>
    					<h1>Resource State</h1>
    				</hgroup>
                    <ul class="small">
                        <li>State</li>
                        <ul>
                            <li>Resource representation is in fact a <b>representation of a resource state</b></li>
                            <li>Resource may be in different states over time</li>
                        </ul>
                    </ul>
    				<div class="h-drawing" style="height: 250px; margin: 15px 0px 15px 0px;" 
    					id="1dhjNo4p6x5rS-IH3E2WcVw3TxwCqmdhtA-9wD0hwbuc"></div>
                    <ul class="small space-before">
                        <li>In REST resource states represent application states</li>                    
                    </ul>
    			</div>           
                
                <div class="slide" id="resource-state">
    				<hgroup>
    					<h1>Resource State Example</h1>
    				</hgroup>
                    <ul class="x-small">
                        <li>Time <span class="h-latex lower">t_1</span>: client A retrieves a resource <code>/orders</code> (GET)</li>
                        <pre class="brush: xml; class-name: 'tight'">
                            &lt;orders>
                                &lt;order id="54467"/>
                                &lt;order id="65432"/>
                            &lt;/orders>                                                
                        </pre>
                        <li>Time <span class="h-latex lower">t_2</span>: client B adds a new order (POST)</li>
                        <pre class="brush: xml; class-name: 'tight'">
                            &lt;order>
                                ...
                            &lt;/order>                                                
                        </pre>
                        <li>Time <span class="h-latex lower">t_3</span>: client A retrieves a resource <code>/orders</code> (GET)</li>
                        <pre class="brush: xml; class-name: 'tight'">
                            &lt;orders>
                                &lt;order id="54467"/>
                                &lt;order id="65432"/>
                                &lt;order id="74567"/>
                            &lt;/orders>                                                
                        </pre>
                        <li>The resource <code>/orders</code> has different states in <span class="h-latex lower">t_1</span>
                        and <span class="h-latex lower">t_3</span>.
                    </ul>
    			</div>           
                
                
            </section>
            
            <div class="slide outline"></div>

            <section>
                <header>Content Negotiation</header>

                <div class="slide">
                    <hgroup>
                        <h1>Content Negotiation</h1>
                    </hgroup>
                    <ul>
                        <li>Advantages</li>
                        <ul>
                            <li>Different clients may want to use different formats</li>
                            <ul>
                                <li>Web browser: JSON</li>
                                <li>Java client: XML</li>
                                <li>Ruby client: YAML</li>
                            </ul>
                            <li>Clients want internationalized data<br/>
                                &rarr; translated information in various languages</li>
                            <li>applications evolve<br/>
                                &rarr; need for version support</li>
                        </ul>
                        <li>HTTP Content Negotiation</li>
                        <ul>
                            <li>a protocol, also called conneg</li>
                            <li>format, encoding, language</li>
                        </ul>
                    </ul>
                </div>

                <div class="slide">
                    <hgroup>
                        <h1>Representation Negotiation</h1>
                    </hgroup>
                    <ul class="x-small">
                        <li>Client requests specific media types it supports</li>
                        <ul>
                            <li>client sets <code>Accept</code> header in the request</li>
                            <ul>
                                <li>the value is a comma delimited set of content types</li>
                            </ul>
                        </ul>
                        <li>Specific requests</li>
                        <ul>
                            <li>to ask for xml or json representations:</li>
                            <pre class="brush: plain; gutter: 'false'">
							&gt; GET /orders HTTP/1.1
							&gt; Accept: application/xml, application/json
                            </pre>
                            <li>server choses one of the types (by applying preference ordering) and serializes the resource in that type</li>
                            <li>when the server cannot find any type, it sends <code>406 Not Acceptable</code> response code</li>
                        </ul>
                        <li>Generic requests</li>
                        <ul>
                            <li>client may specify wildcards to ask for any type or subtype</li>
                            <pre class="brush: plain; gutter: 'false'">
    						&gt; GET /orders HTTP/1.1
							&gt; Accept: text/*, text/html; level=1
                            </pre>
                        </ul>
                    </ul>
                </div>

                <div class="slide">
                    <hgroup>
                        <h1>Preference Ordering &ndash; Implicit Rule</h1>
                    </hgroup>
                    <ul class="small">
                        <li>Implicit rule</li>
                        <ul>
                            <li>More specific media type takes preference over less specific ones. Example:</li>
                            <pre class="brush: plain; gutter: 'false'">
        					&gt; GET /orders HTTP/1.1
							&gt; Accept: text/*, text/html;level=1, */*, application/xml
                            </pre>
                            <li class="space-before">server interprets the client preference as:<br/>
                                1. <code>text/html;level=1</code> &ndash; most specific<br/>
                                2. <code>application/xml</code> &ndash; no parameters<br/>
                                3. <code>text/*</code> &ndash; more concrete than match-all<br/>
                                4. <code>*/*</code> &ndash; less specific<br/>
                        </ul>
                    </ul>
                </div>

                <div class="slide">
                    <hgroup>
                        <h1>Preference Ordering &ndash; Explicit Rules</h1>
                    </hgroup>
                    <ul class="small">
                        <li>Explicit rules</li>
                        <ul>
                            <li>using <code>q</code> parameter (qualifier), numeric value from 0.0 to 1.0
                                (1.0 indicates the most preferred type)</li>
                            <pre class="brush: plain; gutter: 'false'">
            				&gt; GET /orders HTTP/1.1
							&gt; Accept: text/*;q=0.9, */*;q=0.1, application/json, application/xml;q=0.5
                            </pre>
                            <li class="space-before">server interprets the client preference as:<br/>
                                1. <code>application/json</code> &ndash; implicit qualifier 1.0, most specific<br/>
                                2. <code>text/*</code> &ndash; the second next highest qualifier 0.9<br/>
                                3. <code>application/xml</code> &ndash; more specific but lower pref. value 0.5<br/>
                                4. <code>*/*</code> &ndash; anything otherwise<br/>
                        </ul>
                    </ul>
                </div>

                <div class="slide">
                    <hgroup>
                        <h1>Language and Encoding Negotiation</h1>
                    </hgroup>
                    <ul class="x-small">
                        <li>Language negotiation</li>
                        <ul>
                            <li>Client uses <code>Accept-Language</code> header; the value is a comma
                                separated list of language (ISO 639) and country codes (ISO 3166)</li>
                            <pre class="brush: plain; gutter: 'false'; class-name: 'tight'">
                			&gt; GET /orders HTTP/1.1
							&gt; Accept-Language: en-us, cs, fr

                            &lt; Content-Language: en-us
                            </pre>
                            <li>Supports preference qualifiers too</li>
                        </ul>
                        <li>Encoding negotiation</li>
                        <ul>
                            <li>Client uses <code>Accept-Encoding</code> for message compression<br/>
                                the value is a comma separated list of acceptable compressions</li>
                            <pre class="brush: plain; gutter: 'false'; class-name: 'tight'">
                    		&gt; GET /orders HTTP/1.1
							&gt; Accept-Encoding: gzip, deflate

                            &lt; Content-Encoding: gzip
                            </pre>
                            <li>Supports preference qualifiers too</li>
                            <li>When a client or a server compress a message body the
                                <code>Content-Encoding</code> must always be specified!</li>
                        </ul>
                    </ul>
                </div>

                <div class="slide" id="resource-versions">
                    <hgroup>
                        <h1>Resource Version Negotiation</h1>
                    </hgroup>
                    <ul class="small">
                        <li>Applications and their resources evolve</li>
                        <ul>
                            <li>A service need to support old clients</li>
                            <li>The service's URI and methods do not need to change &ndash; the content it provides may be in different versions</li>
                            <li>cf. <a href="lecture2.html#/resource-versions">resource versions in Lecture 2</a>.
                        </ul>
                        <li>Encode the version information</li>
                        <pre class="brush: plain; gutter: 'false'">
                			&gt; GET /orders HTTP/1.1
							&gt; Accept: application/xml; version=2.0

                            &lt; HTTP/1.1 200 OK
                            &lt; Content-Type: application/xml; version=2.0
                            </pre>
                    </ul>

                    </ul>
                </div>

                <div class="slide">
                    <hgroup>
                        <h1>Respecting Standards?</h1>
                    </hgroup>
                    <ul class="x-small spacing">
                        <li>HTTP specification is very powerful</li>
                        <ul>
                            <li>but some clients ignore HTTP features</li>
                            <ul>
                                <li>such as Firefox hardcodes <code>Accept</code> header as<br/>
                                    <code>text/html,application/xhtml+xml,application/xml,*/*</code></li>
                                <li>hence it is impossible to to negotiate e.g. a JSON format</li>
                            </ul>
                            <li>Or if you want to test something quickly</li>
                            <ul>
                                <li>using <code>curl</code> is not as quick as entering URL to a browser</li>
                            </ul>
                        </ul>
                        <li>Negotiation by URI patterns</li>
                        <ul>
                            <li>quite common, for example:<br/>
                                <code>http://company.com/orders/?alt=json</code> (Google APIs)</li>
                            <li>or in the URI path component:<br/>
                                <code>http://company.com/orders.xml</code><br/>
                                <code>http://company.com/orders.xml.en-us</code><br/>
                                <code>http://company.com/orders.json</code></li>
                            <li>But be aware of the <a href="lecture2.html#/uri-opacity">URI Opacity</a>!</li>
                        </ul>
                    </ul>
                </div>
            </section>

        </section>

    </body>
</html>
